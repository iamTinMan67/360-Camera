[1mdiff --git a/src/pages/Camera.jsx b/src/pages/Camera.jsx[m
[1mindex 1e4c54c..be2d918 100644[m
[1m--- a/src/pages/Camera.jsx[m
[1m+++ b/src/pages/Camera.jsx[m
[36m@@ -1,13 +1,16 @@[m
 import { useState, useRef, useEffect } from 'react'[m
[31m-import { useSearchParams, Link } from 'react-router-dom'[m
[31m-import { Camera as CameraIcon, Video, Square, Download, X, AlertCircle, RefreshCw, Cloud, Copy, Check, Turtle, Rabbit, Gauge } from 'lucide-react'[m
[32m+[m[32mimport { useSearchParams, Link, useLocation, useNavigate } from 'react-router-dom'[m
[32m+[m[32mimport { Camera as CameraIcon, Video, Square, Download, X, AlertCircle, RefreshCw, Cloud, Turtle, Rabbit, Gauge } from 'lucide-react'[m
 import { useEvents } from '../context/EventContext'[m
[32m+[m[32mimport { useAuth } from '../context/AuthContext'[m
 import { uploadMediaToSupabase } from '../utils/supabaseMedia'[m
 import { supabase } from '../config/supabase'[m
 [m
 export default function Camera() {[m
   const [searchParams] = useSearchParams()[m
   const mode = searchParams.get('mode') || 'photo' // 'photo' or 'video'[m
[32m+[m[32m  const location = useLocation()[m
[32m+[m[32m  const navigate = useNavigate()[m
   [m
   const videoRef = useRef(null)[m
   const canvasRef = useRef(null)[m
[36m@@ -30,15 +33,17 @@[m [mexport default function Camera() {[m
   const [isCountingDown, setIsCountingDown] = useState(false)[m
   const [countdownValue, setCountdownValue] = useState(0)[m
   const [initialCountdownValue, setInitialCountdownValue] = useState(0)[m
[31m-  const [uploadedLinks, setUploadedLinks] = useState([])[m
[31m-  const [copiedLink, setCopiedLink] = useState(null)[m
   const [videoReady, setVideoReady] = useState(false)[m
   const [streamIsLandscape, setStreamIsLandscape] = useState(false)[m
   const [isLoopRecording, setIsLoopRecording] = useState(false)[m
   [m
   const { currentEvent, addMediaToEvent, updateEvent } = useEvents()[m
[32m+[m[32m  const { isAuthenticated } = useAuth()[m
 [m
   const requestFullscreenOrientation = async (orientation) => {[m
[32m+[m[32m    // During development, avoid forcing fullscreen/orientation so it's easier to work in the browser.[m
[32m+[m[32m    if (import.meta.env.DEV) return[m
[32m+[m
     // Best-effort: iOS Safari usually requires a user gesture for fullscreen/orientation lock.[m
     try {[m
       if (!document.fullscreenElement && document.documentElement.requestFullscreen) {[m
[36m@@ -57,6 +62,14 @@[m [mexport default function Camera() {[m
     }[m
   }[m
 [m
[32m+[m[32m  const handleExit = () => {[m
[32m+[m[32m    if (!isAuthenticated) {[m
[32m+[m[32m      navigate('/login?next=/events', { state: { backgroundLocation: location } })[m
[32m+[m[32m      return[m
[32m+[m[32m    }[m
[32m+[m[32m    navigate('/')[m
[32m+[m[32m  }[m
[32m+[m
   // Detect Safari browser[m
   const isSafari = () => {[m
     return /^((?!chrome|android).)*safari/i.test(navigator.userAgent) || [m
[36m@@ -200,7 +213,9 @@[m [mexport default function Camera() {[m
       stream.getTracks().forEach(track => track.stop())[m
       setStream(null)[m
       // Wait a moment after cleanup before requesting new stream[m
[31m-      await new Promise(resolve => setTimeout(resolve, 100))[m
[32m+[m[32m      const isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'[m
[32m+[m[32m      // iOS Safari often needs more time to release the camera between sessions[m
[32m+[m[32m      await new Promise(resolve => setTimeout(resolve, isLocalhost ? 150 : 800))[m
     }[m
     if (videoRef.current && videoRef.current.srcObject) {[m
       videoRef.current.srcObject = null[m
[36m@@ -231,21 +246,20 @@[m [mexport default function Camera() {[m
         {[m
           video: {[m
             facingMode: { ideal: 'user' },[m
[31m-            aspectRatio: { ideal: 3 / 4 }, // portrait[m
[31m-            width: { ideal: 1440, max: 1920 },[m
[31m-            height: { ideal: 1920, max: 2560 },[m
[31m-            frameRate: { ideal: 30, max: 60 }[m
[32m+[m[32m            // Avoid strict aspect ratio constraints on iOS Safari; we rotate/crop in UI/canvas as needed.[m
[32m+[m[32m            width: { ideal: 1280, max: 1920 },[m
[32m+[m[32m            height: { ideal: 720, max: 1440 }[m
           },[m
[31m-          audio: true[m
[32m+[m[32m          // Photo booth does not need microphone; requesting audio can break getUserMedia on iOS/production.[m
[32m+[m[32m          audio: false[m
         },[m
         {[m
           video: {[m
             facingMode: { ideal: 'user' },[m
[31m-            aspectRatio: { ideal: 3 / 4 },[m
[31m-            width: { ideal: 1080 },[m
[31m-            height: { ideal: 1440 }[m
[32m+[m[32m            width: { ideal: 1280 },[m
[32m+[m[32m            height: { ideal: 720 }[m
           },[m
[31m-          audio: true[m
[32m+[m[32m          audio: false[m
         }[m
       ][m
 [m
[36m@@ -254,48 +268,46 @@[m [mexport default function Camera() {[m
         {[m
           video: {[m
             facingMode: { ideal: 'user' },[m
[31m-            aspectRatio: { ideal: 16 / 9 }, // landscape[m
[31m-            width: { ideal: 1920, max: 3840 },[m
[31m-            height: { ideal: 1080, max: 2160 },[m
[31m-            frameRate: { ideal: 60, max: 60 }[m
[32m+[m[32m            // Avoid strict aspect ratio constraints; keep requests conservative for iOS Safari reliability.[m
[32m+[m[32m            width: { ideal: 1280, max: 1920 },[m
[32m+[m[32m            height: { ideal: 720, max: 1080 },[m
[32m+[m[32m            frameRate: { ideal: 30, max: 60 }[m
           },[m
[31m-          audio: true[m
[32m+[m[32m          // Start camera without microphone to reduce "Starting videoinput failed" cases on iOS.[m
[32m+[m[32m          // (MediaRecorder may still record video-only; we can add mic later if desired.)[m
[32m+[m[32m          audio: false[m
         },[m
         {[m
           video: {[m
             facingMode: { ideal: 'user' },[m
[31m-            aspectRatio: { ideal: 16 / 9 },[m
[31m-            width: { ideal: 1920, max: 3840 },[m
[31m-            height: { ideal: 1080, max: 2160 },[m
[31m-            frameRate: { ideal: 30, max: 60 }[m
[32m+[m[32m            width: { ideal: 1280, max: 1920 },[m
[32m+[m[32m            height: { ideal: 720, max: 1080 }[m
           },[m
[31m-          audio: true[m
[32m+[m[32m          audio: false[m
         },[m
         {[m
           video: {[m
             facingMode: { ideal: 'user' },[m
[31m-            aspectRatio: { ideal: 16 / 9 },[m
[31m-            width: { ideal: 1280, max: 1920 },[m
[31m-            height: { ideal: 720, max: 1080 },[m
[31m-            frameRate: { ideal: 60, max: 60 }[m
[32m+[m[32m            width: { ideal: 640, max: 1280 },[m
[32m+[m[32m            height: { ideal: 480, max: 720 }[m
           },[m
[31m-          audio: true[m
[32m+[m[32m          audio: false[m
         },[m
         {[m
           video: {[m
             facingMode: { ideal: 'user' },[m
[31m-            width: { ideal: 1280 },[m
[31m-            height: { ideal: 720 }[m
[32m+[m[32m            width: { ideal: 640 },[m
[32m+[m[32m            height: { ideal: 480 }[m
           },[m
[31m-          audio: true[m
[32m+[m[32m          audio: false[m
         }[m
       ][m
 [m
       const tryConstraints = [[m
         ...(mode === 'video' ? videoConstraints : photoConstraints),[m
         // fallbacks[m
[31m-        { video: { facingMode: { ideal: 'user' } }, audio: true },[m
[31m-        { video: true, audio: true },[m
[32m+[m[32m        { video: { facingMode: { ideal: 'user' } }, audio: false },[m
[32m+[m[32m        { video: true, audio: false },[m
         { video: { facingMode: { ideal: 'user' } }, audio: false },[m
         { video: true, audio: false }[m
       ][m
[36m@@ -339,8 +351,14 @@[m [mexport default function Camera() {[m
             constraint: tryConstraints[i][m
           })[m
           lastError = error[m
[31m-          // If it's a permission error, don't try other constraints[m
[32m+[m[32m          // Permission errors can be caused by microphone denial when audio:true.[m
[32m+[m[32m          // If this attempt requested audio, try subsequent constraints that disable audio.[m
           if (error.name === 'NotAllowedError' || error.name === 'PermissionDeniedError') {[m
[32m+[m[32m            const requestedAudio = Boolean(tryConstraints[i]?.audio)[m
[32m+[m[32m            const hasAudioFalseFallback = tryConstraints.slice(i + 1).some(c => c?.audio === false)[m
[32m+[m[32m            if (requestedAudio && hasAudioFalseFallback) {[m
[32m+[m[32m              continue[m
[32m+[m[32m            }[m
             throw error[m
           }[m
           // If it's NotReadableError or videoinput error and we have more attempts, continue[m
[36m@@ -366,9 +384,19 @@[m [mexport default function Camera() {[m
         // Provide more helpful error message[m
         const errorMessage = lastError?.message || 'Unknown error'[m
         if (errorMessage.includes('videoinput') || errorMessage.includes('Starting videoinput')) {[m
[31m-          throw new Error('Camera hardware initialization failed. The camera may be in use by another application or there may be a driver issue.')[m
[32m+[m[32m          // One more conservative retry after a longer delay (helps iOS Safari release the camera)[m
[32m+[m[32m          console.warn('âš ï¸ CAMERA DEBUG: videoinput failed; retrying once with minimal constraints after delay...')[m
[32m+[m[32m          await new Promise(resolve => setTimeout(resolve, 1500))[m
[32m+[m[32m          try {[m
[32m+[m[32m            mediaStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false })[m
[32m+[m[32m          } catch (retryErr) {[m
[32m+[m[32m            console.error('âŒ CAMERA DEBUG: Minimal retry also failed:', retryErr)[m
[32m+[m[32m            throw new Error('Camera hardware initialization failed. Please close other apps using the camera and try again.')[m
[32m+[m[32m          }[m
[32m+[m[32m        }[m
[32m+[m[32m        if (!mediaStream) {[m
[32m+[m[32m          throw lastError || new Error('Could not access camera with any constraints')[m
         }[m
[31m-        throw lastError || new Error('Could not access camera with any constraints')[m
       }[m
 [m
       setStream(mediaStream)[m
[36m@@ -395,6 +423,10 @@[m [mexport default function Camera() {[m
       if (videoRef.current) {[m
         const video = videoRef.current[m
         video.srcObject = mediaStream[m
[32m+[m[32m        // Ensure the element is actually visible to the browser's video pipeline (iOS Safari quirk)[m
[32m+[m[32m        video.style.display = 'block'[m
[32m+[m[32m        video.style.visibility = 'visible'[m
[32m+[m[32m        video.style.opacity = '1'[m
         [m
         console.log('ðŸŽ¥ CAMERA DEBUG: Video element srcObject set')[m
         console.log('ðŸŽ¥ CAMERA DEBUG: Video element state:', {[m
[36m@@ -488,12 +520,14 @@[m [mexport default function Camera() {[m
     setCapturedMedia(null)[m
   }[m
 [m
[31m-  // Auto-start camera when component mounts (but not for Safari - requires user interaction)[m
[32m+[m[32m  // Auto-start camera when component mounts (only on localhost).[m
[32m+[m[32m  // On iOS / production browsers, camera permission often requires a user gesture.[m
   useEffect(() => {[m
     const initCamera = async () => {[m
[31m-      // Safari requires user interaction to request camera permissions[m
[31m-      // So we skip auto-start for Safari and show a button instead[m
[31m-      if (!isSafari() && !stream && !cameraError) {[m
[32m+[m[32m      const isLocalhost =[m
[32m+[m[32m        window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'[m
[32m+[m
[32m+[m[32m      if (isLocalhost && !isSafari() && !stream && !cameraError) {[m
         await startCamera()[m
       }[m
     }[m
[36m@@ -517,6 +551,25 @@[m [mexport default function Camera() {[m
     }[m
   }, [stream])[m
 [m
[32m+[m[32m  // If mode changes (photo <-> video), reset mode-specific state and restart the camera with new constraints.[m
[32m+[m[32m  useEffect(() => {[m
[32m+[m[32m    // Clear any captured overlay that can make the camera look "frozen"[m
[32m+[m[32m    setCapturedMedia(null)[m
[32m+[m[32m    setCapturedShots([])[m
[32m+[m[32m    setIsRecording(false)[m
[32m+[m[32m    setIsLoopRecording(false)[m
[32m+[m[32m    setVideoReady(false)[m
[32m+[m[32m    setStreamIsLandscape(false)[m
[32m+[m
[32m+[m[32m    // Restart camera to apply the correct constraints for the new mode.[m
[32m+[m[32m    // Safari requires user interaction, so we don't auto-start there.[m
[32m+[m[32m    stopCamera()[m
[32m+[m[32m    if (!isSafari()) {[m
[32m+[m[32m      startCamera()[m
[32m+[m[32m    }[m
[32m+[m[32m    // eslint-disable-next-line react-hooks/exhaustive-deps[m
[32m+[m[32m  }, [mode])[m
[32m+[m
   // Ensure video plays when stream is set and check when it's ready (important for Safari)[m
   useEffect(() => {[m
     console.log('ðŸŽ¥ CAMERA DEBUG: useEffect triggered, stream:', !!stream, 'videoRef:', !!videoRef.current)[m
[36m@@ -1005,7 +1058,7 @@[m [mexport default function Camera() {[m
     // If there's already a captured video, discard it[m
     if (capturedMedia) {[m
       setCapturedMedia(null)[m
[31m-      setUploadedLinks([])[m
[32m+[m[32m      // no-op: removed "Supabase Upload Complete" panel[m
     }[m
 [m
     // 5 second countdown before starting recording[m
[36m@@ -1156,7 +1209,6 @@[m [mexport default function Camera() {[m
 [m
     const eventId = currentEvent.id[m
     setIsUploading(true)[m
[31m-    setUploadedLinks([])[m
 [m
     try {[m
       // Sync event to Supabase if it doesn't have a supabaseEventId[m
[36m@@ -1214,7 +1266,7 @@[m [mexport default function Camera() {[m
           )[m
         )[m
 [m
[31m-      const links = [][m
[32m+[m[32m      // Removed the "Supabase Upload Complete" links panel; keep uploads + alerts only.[m
         let supabaseSuccessCount = 0[m
         for (let i = 0; i < capturedShots.length; i++) {[m
           const shot = capturedShots[i][m
[36m@@ -1227,7 +1279,6 @@[m [mexport default function Camera() {[m
             if (supabaseResult.success) {[m
               supabaseUrl = supabaseResult.publicUrl[m
               supabaseSuccessCount += 1[m
[31m-              links.push(supabaseUrl)[m
             } else {[m
               console.error(`Failed to upload photo ${i + 1}:`, supabaseResult.error, supabaseResult.details)[m
             }[m
[36m@@ -1249,7 +1300,6 @@[m [mexport default function Camera() {[m
           reader.readAsDataURL(file)[m
         }[m
 [m
[31m-        setUploadedLinks(links)[m
         setCapturedShots([])[m
         setCapturedMedia(null)[m
         [m
[36m@@ -1276,7 +1326,6 @@[m [mexport default function Camera() {[m
           if (supabaseResult.success) {[m
             supabaseUrl = supabaseResult.publicUrl[m
             supabaseSuccess = true[m
[31m-            setUploadedLinks([supabaseUrl])[m
           } else {[m
             console.error('Failed to upload media:', supabaseResult.error, supabaseResult.details)[m
           }[m
[36m@@ -1540,7 +1589,8 @@[m [mexport default function Camera() {[m
       <div className="absolute inset-0 z-10">[m
         <div className="absolute top-4 left-4 z-50">[m
           <Link[m
[31m-            to="/"[m
[32m+[m[32m            to={isAuthenticated ? '/' : '/login?next=/events'}[m
[32m+[m[32m            state={!isAuthenticated ? { backgroundLocation: location } : undefined}[m
             className="inline-flex items-center gap-2 bg-black/60 text-white hover:bg-black/80 px-3 py-2 rounded-lg"[m
           >[m
             <X className="h-5 w-5" />[m
[36m@@ -1559,8 +1609,11 @@[m [mexport default function Camera() {[m
               muted[m
               className="absolute top-1/2 left-1/2 object-cover"[m
               style={{ [m
[31m-                display: stream ? 'block' : 'none',[m
[31m-                visibility: stream ? 'visible' : 'hidden',[m
[32m+[m[32m                // Keep the video element in the layout even before the stream is ready.[m
[32m+[m[32m                // On iOS Safari, display:none can prevent metadata/dimensions from ever populating.[m
[32m+[m[32m                display: 'block',[m
[32m+[m[32m                visibility: 'visible',[m
[32m+[m[32m                opacity: stream ? 1 : 0,[m
                 width: streamIsLandscape !== (mode === 'video') ? '100vh' : '100vw',[m
                 height: streamIsLandscape !== (mode === 'video') ? '100vw' : '100vh',[m
                 transform:[m
[36m@@ -1687,28 +1740,25 @@[m [mexport default function Camera() {[m
                     <RefreshCw className="h-16 w-16 mb-4 animate-spin" />[m
                     <p className="text-sm">Starting camera...</p>[m
                   </>[m
[31m-                ) : isSafari() ? ([m
[32m+[m[32m                ) : ([m
                   <>[m
                     <CameraIcon className="h-16 w-16 mb-4 text-purple-500" />[m
                     <p className="text-sm mb-4 text-center">[m
[31m-                      Safari requires permission to access your camera.[m
[31m-                    </p>[m
[31m-                    <p className="text-xs mb-4 text-center text-gray-500">[m
[31m-                      Click the button below to enable camera access.[m
[32m+[m[32m                      Tap below to enable camera access.[m
                     </p>[m
[32m+[m[32m                    {isSafari() && ([m
[32m+[m[32m                      <p className="text-xs mb-4 text-center text-gray-500">[m
[32m+[m[32m                        iPad/iPhone browsers require a tap to start the camera.[m
[32m+[m[32m                      </p>[m
[32m+[m[32m                    )}[m
                     <button[m
                       onClick={startCamera}[m
[31m-                      className="btn-primary mt-4"[m
[32m+[m[32m                      className="btn-primary mt-2"[m
                     >[m
                       <CameraIcon className="inline-block mr-2 h-5 w-5" />[m
                       Enable Camera[m
                     </button>[m
                   </>[m
[31m-                ) : ([m
[31m-                  <>[m
[31m-                    <CameraIcon className="h-16 w-16 mb-4" />[m
[31m-                    <p className="text-sm">Camera will start automatically</p>[m
[31m-                  </>[m
                 )}[m
               </div>[m
             )}[m
[36m@@ -1822,61 +1872,87 @@[m [mexport default function Camera() {[m
             ) : stream ? ([m
               <>[m
                 {mode === 'photo' ? ([m
[31m-                  <button [m
[31m-                    onClick={capturePhoto} [m
[31m-                    className={`font-semibold py-2 px-4 rounded-lg transition-colors ${[m
[31m-                      isCapturing || isCountingDown || isUploading || !videoReady[m
[31m-                        ? 'bg-gray-400 text-gray-600 cursor-not-allowed'[m
[31m-                        : 'bg-green-500 hover:bg-green-600 text-white'[m
[31m-                    }`}[m
[31m-                    disabled={isCapturing || isCountingDown || isUploading || !videoReady}[m
[31m-                    title={!videoReady ? 'Waiting for camera to be ready...' : ''}[m
[31m-                  >[m
[31m-                    <CameraIcon className="inline-block mr-2 h-5 w-5" />[m
[31m-                    {isCapturing ? `Capturing ${capturedShots.length + 1}/${shotCount}...` : `Take ${shotCount} Photo${shotCount > 1 ? 's' : ''}`}[m
[31m-                  </button>[m
[32m+[m[32m                  <div className="flex flex-col items-center gap-2">[m
[32m+[m[32m              